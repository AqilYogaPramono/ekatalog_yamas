<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../../../partials/__head.ejs', { title: 'Daftar Buku' }) %>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }

        .main-panel {
                background-color: white;
        }
        
        .container-custom {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            margin-top: 5%;
            margin-left: auto;
        }

        .btn-add,
        .btn-import,
        .btn-template {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            transition: background-color 0.2s ease, transform 0.2s ease;
            text-align: center;
            justify-content: center;
            flex-grow: 1;
            white-space: nowrap;
        }

        .btn-add {
            background-color: #0F8EC8;
            color: white;
            border: 1px solid #0F8EC8;
        }

        .btn-add:hover {
            background-color: #0c75a4;
            transform: translateY(-2px);
        }

        .btn-import {
            background-color: white;
            color: #0F8EC8;
            border: 1px solid #0F8EC8;
        }

        .btn-import:hover {
            background-color: #f1f7fc;
            transform: translateY(-2px);
        }

        .btn-template {
            background-color: #6c757d;
            color: white;
            border: 1px solid #6c757d;
        }

        .btn-template:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        .search-and-entries {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            flex-grow: 1;
            justify-content: flex-end;
        }

        #entriesPerPage {
            border-radius: 6px;
            border: 1px solid #e9ecef;
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        #searchInput {
            border-radius: 6px;
            border: 1px solid #e9ecef;
            padding: 8px 12px;
            width: 200px;
            font-size: 0.9rem;
            transition: width 0.3s ease;
        }

        .book-list-header {
            font-size: 1.75rem;
            font-weight: 600;
            color: #0F8EC8;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .book-card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 5px solid #0F8EC8;
        }

        .book-card:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .book-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .book-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0F8EC8;
            padding-right: 20px;
            border-right: 1px solid #e9ecef;
        }

        .book-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333333;
            margin: 0;
        }

        .book-author {
            font-size: 0.9rem;
            color: #6c757d;
            margin: 0;
        }

        .book-details-link {
            background-color: transparent;
            border: none;
            color: #0F8EC8;
            font-weight: 600;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s ease, transform 0.2s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .book-details-link:hover {
            background-color: #f1f7fc;
            transform: translateY(-2px);
        }

        .data-table-pagination {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 1rem;
            gap: 15px;
            flex-wrap: wrap;
        }

        .pagination-info {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .pagination {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .page-item .page-link {
            border: 1px solid #dee2e6;
            color: #0F8EC8;
            margin: 0 2px;
            border-radius: 4px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .page-item.active .page-link {
            background-color: #0F8EC8;
            color: white;
            border-color: #0F8EC8;
        }

        #noInitialDataMessage,
        #noResultsMessage {
            text-align: center;
            color: #6c757d;
            margin-top: 2rem;
            padding: 1rem;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .book-card {
            display: none;
        }

        @media (max-width: 425px) {
            .header-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .header-buttons {
                flex-direction: column;
                width: 100%;
            }

            .btn-add,
            .btn-import,
            .btn-template {
                width: 100%;
                justify-content: center;
                padding: 15px;
                font-size: 1rem;
            }

            .search-and-entries {
                flex-direction: column;
                align-items: stretch;
                width: 100%;
                gap: 10px;
            }

            #searchInput {
                width: 100%;
            }

            .book-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                text-align: left;
            }

            .book-info {
                gap: 15px;
                width: 100%;
                border-right: none;
                padding-right: 0;
            }

            .book-number {
                border-right: none;
                padding-right: 0;
            }
            
            .book-title {
                font-size: 1.2rem;
            }
        }
    </style>
</head>

<body class="page-buku-index">
    <div class="container-scroller">
        <div class="container-fluid page-body-wrapper full-page-wrapper">
            <%- include('../../../partials/__nav.ejs', { currentPath: '/buku' }) %>
            <div class="main-panel">
                <div class="container-custom">
                    <div class="header-controls">
                        <div class="header-buttons">
                            <a href="/buku/create" class="btn-add">
                                <i class="bi bi-plus-lg"></i> Tambah Buku
                            </a>
                            <a href="#" class="btn-import" id="importExcelBtn">
                                <i class="bi bi-file-earmark-arrow-up"></i> Import Buku Via Excel
                            </a>
                            <a href="#" class="btn-template">
                                <i class="bi bi-file-earmark-arrow-down"></i> Download Template
                            </a>
                        </div>
                        <div class="search-and-entries">
                            <label>
                                <span class="d-none d-md-inline">Show </span>
                                <select id="entriesPerPage" class="form-control d-inline-block w-auto mx-1">
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                </select>
                                <span class="d-none d-md-inline"> entries</span>
                            </label>
                            <input type="text" id="searchInput" class="form-control d-inline-block w-auto ms-3" placeholder="Search...">
                        </div>
                    </div>

                    <h4 class="book-list-header">Daftar Buku</h4>

                    <div id="bookList">
                        <% if (buku.length > 0) { %>
                            <% buku.forEach(function(item, index) { %>
                                <div class="book-card book-item">
                                    <div class="book-info">
                                        <span class="book-number"><%= index + 1 %>.</span>
                                        <div>
                                            <p class="book-title"><%= item.judul %></p>
                                            <p class="book-author"><%= item.penulis %></p>
                                        </div>
                                    </div>
                                    <div class="book-details">
                                        <a href="/buku/detail/<%= item.id_buku %>" class="book-details-link">
                                            Detail <i class="bi bi-arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                            <% }); %>
                        <% } else { %>
                            <div id="noInitialDataMessage">Tidak ada buku yang terdaftar.</div>
                        <% } %>
                    </div>

                    <div id="noResultsMessage" style="display:none;">Tidak ada hasil yang ditemukan.</div>

                    <div class="data-table-pagination">
                        <span class="pagination-info me-3">Showing <span id="paginationStart">0</span> to <span id="paginationEnd">0</span> of <span id="totalEntries">0</span> entries</span>
                        <ul class="pagination">
                            <li class="page-item" id="prevPage">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item" id="nextPage">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="excelUpload" accept=".xlsx, .xls" style="display: none;">

    <%- include('../../../partials/__foot.ejs') %>
    <script src="../../vendors/js/vendor.bundle.base.js"></script>
    <script src="../../vendors/typeahead.js/typeahead.bundle.min.js"></script>
    <script src="../../vendors/select2/select2.min.js"></script>
    <script src="../../js/off-canvas.js"></script>
    <script src="../../js/hoverable-collapse.js"></script>
    <script src="../../js/template.js"></script>
    <script src="../../js/settings.js"></script>
    <script src="../../js/todolist.js"></script>
    <script src="../../js/file-upload.js"></script>
    <script src="../../js/typeahead.js"></script>
    <script src="../../js/select2.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const importExcelBtn = document.getElementById('importExcelBtn');
            const excelUploadInput = document.getElementById('excelUpload');
            
            if (importExcelBtn) {
                importExcelBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    excelUploadInput.click();
                });
            }

            if (excelUploadInput) {
                excelUploadInput.addEventListener('change', function () {
                    if (this.files && this.files[0]) {
                        const file = this.files[0];
                        alert(`File Excel siap diunggah: ${file.name}`);
                    }
                });
            }

            const bookList = document.getElementById('bookList');
            const bookItems = Array.from(bookList.querySelectorAll('.book-item'));
            const searchInput = document.getElementById('searchInput');
            const entriesPerPageSelect = document.getElementById('entriesPerPage');
            const noInitialDataMessage = document.getElementById('noInitialDataMessage');
            const noResultsMessage = document.getElementById('noResultsMessage');
            const paginationControls = document.querySelector('.data-table-pagination');
            const paginationNumbersContainer = document.querySelector('.pagination');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const paginationStartSpan = document.getElementById('paginationStart');
            const paginationEndSpan = document.getElementById('paginationEnd');
            const totalEntriesSpan = document.getElementById('totalEntries');

            let currentPage = 1;
            let itemsPerPage = parseInt(entriesPerPageSelect.value);
            let filteredItems = [];

            function displayItems() {
                const searchTerm = searchInput.value.toLowerCase();
                filteredItems = bookItems.filter(item => {
                    const title = item.querySelector('.book-title').textContent.toLowerCase();
                    const author = item.querySelector('.book-author').textContent.toLowerCase();
                    return title.includes(searchTerm) || author.includes(searchTerm);
                });

                const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
                currentPage = Math.min(currentPage, totalPages || 1);
                
                bookItems.forEach(item => item.style.display = 'none');

                if (bookItems.length === 0 && searchTerm === '') {
                    noInitialDataMessage.style.display = 'block';
                    paginationControls.style.display = 'none';
                    noResultsMessage.style.display = 'none';
                } else if (filteredItems.length === 0) {
                    noInitialDataMessage.style.display = 'none';
                    noResultsMessage.style.display = 'block';
                    paginationControls.style.display = 'none';
                } else {
                    noInitialDataMessage.style.display = 'none';
                    noResultsMessage.style.display = 'none';
                    paginationControls.style.display = 'flex';
                    
                    const startIdx = (currentPage - 1) * itemsPerPage;
                    const endIdx = startIdx + itemsPerPage;

                    for (let i = startIdx; i < endIdx && i < filteredItems.length; i++) {
                        filteredItems[i].style.display = 'flex';
                    }
                }
                
                updatePaginationControls(totalPages);
                updatePaginationInfo();
            }

            function updatePaginationControls(totalPages) {
                paginationNumbersContainer.querySelectorAll('.page-item:not(#prevPage):not(#nextPage)').forEach(el => el.remove());
                
                if (totalPages > 1) {
                    for (let i = 1; i <= totalPages; i++) {
                        const pageItem = document.createElement('li');
                        pageItem.classList.add('page-item');
                        if (i === currentPage) {
                            pageItem.classList.add('active');
                        }
                        const pageLink = document.createElement('a');
                        pageLink.classList.add('page-link');
                        pageLink.href = '#';
                        pageLink.textContent = i;
                        pageLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            if (i !== currentPage) {
                                currentPage = i;
                                displayItems();
                            }
                        });
                        pageItem.appendChild(pageLink);
                        paginationNumbersContainer.insertBefore(pageItem, nextPageBtn);
                    }
                }

                prevPageBtn.classList.toggle('disabled', currentPage === 1 || totalPages <= 1);
                nextPageBtn.classList.toggle('disabled', currentPage === totalPages || totalPages <= 1);
            }

            function updatePaginationInfo() {
                const totalFiltered = filteredItems.length;
                let start = 0;
                let end = 0;

                if (totalFiltered > 0) {
                    start = (currentPage - 1) * itemsPerPage + 1;
                    end = Math.min(start + itemsPerPage - 1, totalFiltered);
                }
                
                paginationStartSpan.textContent = start;
                paginationEndSpan.textContent = end;
                totalEntriesSpan.textContent = totalFiltered;
            }

            searchInput.addEventListener('keyup', displayItems);
            entriesPerPageSelect.addEventListener('change', function () {
                itemsPerPage = parseInt(this.value);
                currentPage = 1;
                displayItems();
            });

            prevPageBtn.addEventListener('click', function (e) {
                e.preventDefault();
                if (currentPage > 1) {
                    currentPage--;
                    displayItems();
                }
            });

            nextPageBtn.addEventListener('click', function (e) {
                e.preventDefault();
                const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    displayItems();
                }
            });
            
            displayItems();
        });
    </script>
</body>

</html>